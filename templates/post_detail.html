{% extends 'base.html' %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<article>
  <header class="post-detail-header fade-in">
    <h1>{{ post.title }}</h1>
    <div class="post-detail-meta">
      <a href="{% url 'profile' post.author.username %}">{{ post.author.username }}</a>
      Â· {{ post.created_at|date:"M d, Y" }}
    </div>
  </header>
  <div class="post-detail-body fade-in">{{ post.body }}</div>
  {% if post.tags.exists %}
  <div class="post-detail-tags fade-in">
    {% for tag in post.tags.all %}
    <a href="{% url 'search' %}?q={{ tag.name|urlencode }}">{{ tag.name }}</a>
    {% endfor %}
  </div>
  {% endif %}
  {% if user.is_authenticated and user == post.author %}
  <div class="post-actions fade-in">
    <a href="{% url 'post_edit' post.pk %}" class="animated-button brutalist-btn">Edit</a>
    <a href="{% url 'post_delete' post.pk %}" class="animated-button brutalist-btn">Delete</a>
  </div>
  {% endif %}
</article>

<section class="comments-section fade-in">
  <h3>Comments</h3>
  {% if user.is_authenticated %}
  <div class="comment-form-wrap">
    <form id="comment-form" action="{% url 'add_comment' post.pk %}" method="post">
      {% csrf_token %}
      {{ comment_form.body }}
      <button type="submit" class="animated-button brutalist-btn" style="margin-top: 0.5rem;">Post comment</button>
    </form>
  </div>
  {% else %}
  <p><a href="{% url 'login' %}">Log in</a> to comment.</p>
  {% endif %}
  <ul id="comment-list" class="comment-list">
    {% include 'partials/comment_list.html' with comments=comments %}
  </ul>
</section>
{% endblock %}
